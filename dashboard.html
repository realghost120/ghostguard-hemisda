<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GhostGuard Panel</title>

<style>
:root{
  --bg:#070f1f;
  --card:#111c33;
  --blue:#3b82f6;
  --blue2:#2563eb;
  --border:rgba(255,255,255,.08);
  --text:#e6f0ff;
  --muted:rgba(230,240,255,.6);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Arial,system-ui,sans-serif;
  background:linear-gradient(160deg,#070f1f,#0b1730);
  color:var(--text);
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:230px;
  background:#0b1426;
  padding:25px;
  border-right:1px solid var(--border);
}

.logo{
  font-weight:900;
  font-size:20px;
  margin-bottom:30px;
}

.nav{
  margin:15px 0;
  cursor:pointer;
  padding:10px;
  border-radius:8px;
  color:var(--muted);
}

.nav:hover{
  background:rgba(59,130,246,.15);
  color:white;
}

.active{
  background:rgba(59,130,246,.25);
  color:white;
}

/* CONTENT */
.content{
  flex:1;
  padding:30px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:20px;
}

.card{
  background:linear-gradient(180deg,#111c33,#0f1a2e);
  padding:20px;
  border-radius:14px;
  border:1px solid var(--border);
  box-shadow:0 10px 40px rgba(0,0,0,.4);
}

.card h3{
  margin-top:0;
  margin-bottom:15px;
}

.row{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  border-bottom:1px solid rgba(255,255,255,.05);
}

.row:last-child{border-bottom:none}

/* PLAYERS */
.player{
  padding:12px;
  border-radius:10px;
  background:rgba(59,130,246,.08);
  margin-bottom:8px;
  cursor:pointer;
  transition:.2s;
}

.player:hover{
  background:rgba(59,130,246,.2);
}

/* LOGS */
.log{
  font-size:13px;
  padding:6px 0;
  border-bottom:1px solid rgba(255,255,255,.05);
  color:var(--muted);
}

/* SIDE PANEL */
#panel{
  position:fixed;
  right:-400px;
  top:0;
  width:350px;
  height:100%;
  background:#0f1a2e;
  padding:25px;
  transition:.3s;
  border-left:1px solid var(--border);
}

#panel.active{right:0}

button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-weight:700;
}

.btn-blue{background:var(--blue);color:white}
.btn-red{background:#ef4444;color:white}
.btn-yellow{background:#f59e0b;color:white}
.btn-grey{background:#1f2937;color:white}
</style>
</head>

<body>

<div class="sidebar">
  <div class="logo">ðŸ‘» GhostGuard</div>
  <div class="nav active" onclick="show('dashboard',this)">Dashboard</div>
  <div class="nav" onclick="show('players',this)">Players</div>
  <div class="nav" onclick="show('logs',this)">Server Logs</div>
</div>

<div class="content">

  <!-- DASHBOARD -->
  <div id="dashboardView">
    <div class="grid">

      <div class="card">
        <h3>License</h3>
        <div class="row"><span>Status</span><span id="licenseStatus">Loading...</span></div>
        <div class="row"><span>Expires</span><span id="licenseExpire">-</span></div>
      </div>

      <div class="card">
        <h3>Server</h3>
        <div class="row"><span>Status</span><span id="serverStatus">Loading...</span></div>
        <div class="row"><span>Players</span><span id="playerCount">0</span></div>
      </div>

    </div>
  </div>

  <!-- PLAYERS -->
  <div id="playersView" style="display:none;">
    <div class="card">
      <h3>Online Players</h3>
      <div id="playerList"></div>
    </div>
  </div>

  <!-- LOGS -->
  <div id="logsView" style="display:none;">
    <div class="card">
      <h3>Live Server Logs</h3>
      <div id="logList"></div>
    </div>
  </div>

</div>

<!-- SIDE PANEL -->
<div id="panel">
  <h3 id="panelName">Player</h3>
  <div id="panelId"></div>

  <button class="btn-yellow" onclick="kick()">Kick</button>
  <button class="btn-red" onclick="ban()">Ban</button>
  <button class="btn-blue" onclick="dm()">Send DM</button>
  <button class="btn-grey" onclick="closePanel()">Close</button>
</div>

<script>
const API="https://ghostgaurd-becakd.onrender.com";
const licenseKey=localStorage.getItem("gg_license_key")||"";
const token=localStorage.getItem("gg_token")||"";

let selectedPlayer=null;

/* VIEW */
function show(view,el){
  document.querySelectorAll(".nav").forEach(n=>n.classList.remove("active"));
  el.classList.add("active");
  dashboardView.style.display="none";
  playersView.style.display="none";
  logsView.style.display="none";
  document.getElementById(view+"View").style.display="block";
}

/* LICENSE */
async function fetchLicense(){
  if(!token) return;
  const res=await fetch(API+"/customer/dashboard",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({token})
  });
  const data=await res.json();
  if(!data.success) return;
  licenseStatus.innerText=data.data.status;
  licenseExpire.innerText=data.data.expires_at?
    new Date(data.data.expires_at).toLocaleString():"Lifetime";
}

/* SERVER */
async function fetchServer(){
  const res=await fetch(API+"/api/server/status/"+encodeURIComponent(licenseKey));
  const data=await res.json();
  serverStatus.innerText=data.online?"Online":"Offline";
  playerCount.innerText=data.players||0;
}

/* PLAYERS */
async function fetchPlayers(){
  const res=await fetch(API+"/api/server/players/"+encodeURIComponent(licenseKey));
  const data=await res.json();
  const list=data.players||[];
  playerList.innerHTML=list.map(p=>`
    <div class="player" onclick="openPanel(${p.id},'${p.name}')">
      ${p.name} (ID: ${p.id})
    </div>
  `).join("");
}

function openPanel(id,name){
  selectedPlayer=id;
  panelName.innerText=name;
  panelId.innerText="Server ID: "+id;
  panel.classList.add("active");
}

function closePanel(){
  panel.classList.remove("active");
}

/* ACTION */
async function send(type,payload){
  await fetch(API+"/api/dashboard/action",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({token,license_key:licenseKey,type,payload})
  });
}

async function kick(){
  const reason=prompt("Reason:");
  if(!reason)return;
  await send("kick",{player:selectedPlayer,reason});
  alert("Kick sent");
}

async function ban(){
  const reason=prompt("Reason:");
  if(!reason)return;
  const duration=prompt("Duration (30m,2h,7d,P):");
  if(!duration)return;
  await send("ban",{player:selectedPlayer,reason,duration});
  alert("Ban sent");
}

async function dm(){
  const message=prompt("Message:");
  if(!message)return;
  await send("dm",{player:selectedPlayer,message});
  alert("DM sent");
}

/* LOGS */
async function fetchLogs(){
  const res=await fetch(API+"/api/server/logs/"+encodeURIComponent(licenseKey));
  const data=await res.json();
  const logs=data.data||[];
  logList.innerHTML=logs.slice(0,50).map(l=>`
    <div class="log">
      ${new Date(l.time).toLocaleTimeString()} - ${l.message}
    </div>
  `).join("");
}

/* AUTO */
setInterval(fetchServer,5000);
setInterval(fetchPlayers,3000);
setInterval(fetchLogs,3000);

fetchLicense();
fetchServer();
fetchPlayers();
fetchLogs();
</script>

</body>
</html>
