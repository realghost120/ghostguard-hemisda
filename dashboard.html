<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GhostGuard Dashboard</title>

<style>
:root{
  --bg1:#070b14; --bg2:#05070d;
  --text:#e8f0ff; --muted:rgba(232,240,255,.65);
  --blue:#3b82f6; --green:#22c55e; --red:#ef4444;
  --shadow:0 18px 70px rgba(0,0,0,.55);
  --radius:18px;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:Arial, sans-serif; color:var(--text);
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  min-height:100vh;
}
header{
  display:flex; justify-content:space-between; align-items:center;
  padding:18px 28px; border-bottom:1px solid rgba(255,255,255,.06);
}
.brand{font-weight:900; font-size:18px}

.nav{
  display:flex;
  gap:10px;
}

.nav button{
  background:none;
  border:1px solid rgba(255,255,255,.1);
  color:var(--text);
  padding:8px 14px;
  border-radius:12px;
  cursor:pointer;
}

.nav button.active{
  background:rgba(59,130,246,.2);
  border-color:rgba(59,130,246,.4);
}

.wrap{max-width:1200px; margin:0 auto; padding:26px 18px 60px}

.card{
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.08);
  border-radius:var(--radius);
  padding:20px;
  box-shadow:var(--shadow);
  margin-bottom:20px;
}

.title{font-weight:900; font-size:20px; margin-bottom:14px}

.logsBox{
  max-height:400px;
  overflow-y:auto;
  background:rgba(0,0,0,.3);
  border:1px solid rgba(255,255,255,.08);
  border-radius:14px;
  padding:10px;
}

.logRow{
  padding:8px 10px;
  border-bottom:1px solid rgba(255,255,255,.05);
  font-size:13px;
}

.logTime{
  color:var(--muted);
  font-size:11px;
}

.status-online{color:var(--green);font-weight:bold}
.status-offline{color:var(--red);font-weight:bold}

.hidden{display:none}
</style>
</head>

<body>

<header>
  <div class="brand">GhostGuard</div>
  <div class="nav">
    <button id="navDashboard" class="active">Dashboard</button>
    <button id="navLogs">Server Logs</button>
  </div>
</header>

<div class="wrap">

  <!-- DASHBOARD VIEW -->
  <div id="viewDashboard">

    <div class="card">
      <div class="title">Server Status</div>

      <div>Status: <span id="ac-status">Loading...</span></div>
      <div>Players: <span id="players-count">0</span></div>
      <div>Version: <span id="ac-version">-</span></div>
      <div>Uptime: <span id="ac-uptime">0s</span></div>
    </div>

  </div>

  <!-- LOGS VIEW -->
  <div id="viewLogs" class="hidden">
    <div class="card">
      <div class="title">Live Server Logs</div>
      <div id="serverLogs" class="logsBox"></div>
    </div>
  </div>

</div>

<script>
const API = "https://ghostgaurd-becakd.onrender.com";
const licenseKey = localStorage.getItem("gg_license_key");

const el = id => document.getElementById(id);

/* NAVIGATION */
el("navDashboard").onclick = () => {
  el("viewDashboard").classList.remove("hidden");
  el("viewLogs").classList.add("hidden");
  el("navDashboard").classList.add("active");
  el("navLogs").classList.remove("active");
};

el("navLogs").onclick = () => {
  el("viewLogs").classList.remove("hidden");
  el("viewDashboard").classList.add("hidden");
  el("navLogs").classList.add("active");
  el("navDashboard").classList.remove("active");
};

/* SERVER STATUS */
async function fetchServerStatus(){
  const res = await fetch(`${API}/api/server/status/${licenseKey}`);
  const data = await res.json();

  const online = data.online;

  el("ac-status").innerText = online ? "Online" : "Offline";
  el("ac-status").className = online ? "status-online" : "status-offline";
  el("players-count").innerText = data.players || 0;
  el("ac-version").innerText = data.version || "-";
  el("ac-uptime").innerText = formatUptime(data.uptime || 0);
}

function formatUptime(seconds){
  const h = Math.floor(seconds/3600);
  const m = Math.floor((seconds%3600)/60);
  const s = seconds%60;
  return `${h}h ${m}m ${s}s`;
}

setInterval(fetchServerStatus,5000);
fetchServerStatus();

/* LOGS */
async function fetchLogs(){
  const res = await fetch(`${API}/api/server/logs/${licenseKey}`);
  const json = await res.json();
  const list = json.data || [];

  el("serverLogs").innerHTML = list.slice(0,60).map(l=>`
    <div class="logRow">
      <div class="logTime">${new Date(l.time).toLocaleTimeString()}</div>
      <div>${l.message}</div>
    </div>
  `).join("");
}

setInterval(fetchLogs,2500);
fetchLogs();
</script>

</body>
</html>
