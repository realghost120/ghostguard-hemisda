<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GhostGuard Panel</title>

<style>
:root{
  --bg:#060b18;
  --sidebar:#0c1426;
  --card:#111c33;
  --border:rgba(255,255,255,.08);
  --blue:#3b82f6;
  --green:#22c55e;
  --red:#ef4444;
  --yellow:#f59e0b;
  --text:#e6f0ff;
  --muted:rgba(230,240,255,.6);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Arial,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
}
.sidebar{
  width:230px;
  background:var(--sidebar);
  min-height:100vh;
  padding:20px 15px;
  border-right:1px solid var(--border);
}
.logo{font-weight:900;font-size:18px;margin-bottom:22px}
.nav-item{
  padding:12px;
  border-radius:10px;
  margin-bottom:8px;
  cursor:pointer;
  color:var(--muted);
}
.nav-item.active{
  background:rgba(59,130,246,.25);
  color:var(--text);
}
.content{flex:1;padding:26px}
.card{
  background:var(--card);
  padding:18px;
  border-radius:14px;
  border:1px solid var(--border);
  margin-bottom:18px;
}
.row{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
}
.status-online{color:var(--green);font-weight:900}
.status-offline{color:var(--red);font-weight:900}
.status-warn{color:var(--yellow);font-weight:900}
.hidden{display:none}
</style>
</head>

<body>

<div class="sidebar">
  <div class="logo">ðŸ‘» GhostGuard</div>
  <div class="nav-item active" onclick="showView('dashboard',this)">Dashboard</div>
  <div class="nav-item" onclick="showView('players',this)">Players</div>
  <div class="nav-item" onclick="showView('logs',this)">Server Logs</div>
</div>

<div class="content">

<div id="dashboardView">
  <div class="card">
    <h3>License</h3>
    <div class="row"><span>Status</span><span id="license-status">Loading...</span></div>
    <div class="row"><span>Expires</span><span id="license-expire">-</span></div>
    <div class="row"><span>Time Left</span><span id="license-left">-</span></div>
  </div>

  <div class="card">
    <h3>Server</h3>
    <div class="row"><span>Status</span><span id="server-status">Loading...</span></div>
    <div class="row"><span>Players</span><span id="players-count">0</span></div>
  </div>
</div>

<div id="playersView" class="hidden">
  <div class="card">
    <h3>Online Players</h3>
    <div id="players-list"></div>
  </div>
</div>

<div id="logsView" class="hidden">
  <div class="card">
    <h3>Server Logs</h3>
    <div id="logs-box"></div>
  </div>
</div>

</div>

<script>
<script>
const API = "https://ghostgaurd-becakd.onrender.com";
const licenseKey = localStorage.getItem("gg_license_key") || "";
const token = localStorage.getItem("gg_token") || "";

let selectedPlayer = null;

/* ================= VIEW SWITCH ================= */
function showView(view, el){
  document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
  el.classList.add("active");

  ["dashboard","players","logs"].forEach(v=>{
    document.getElementById(v+"View").classList.add("hidden");
  });

  document.getElementById(view+"View").classList.remove("hidden");
}

/* ================= PLAYERS ================= */
async function fetchPlayers(){
  if(!licenseKey) return;

  try{
    const res = await fetch(API + "/api/server/players/" + encodeURIComponent(licenseKey));
    const data = await res.json();

    const list = data.players || [];
    const container = document.getElementById("players-list");

    if(list.length === 0){
      container.innerHTML = "<div style='opacity:.6'>Inga spelare online</div>";
      return;
    }

    container.innerHTML = list.map(p => `
      <div class="player-row" onclick="openPlayerPanel(${p.id}, '${p.name.replace(/'/g,"")}')">
        <div>
          <div class="player-name">${p.name}</div>
          <div class="player-sub">ID: ${p.id} â€¢ Ping: ${p.ping}</div>
        </div>
        <div class="arrow">â†’</div>
      </div>
    `).join("");

  }catch(e){
    console.error(e);
  }
}

/* ================= SIDE PANEL ================= */
function openPlayerPanel(id, name){
  selectedPlayer = id;

  document.getElementById("panelPlayerName").innerText = name;
  document.getElementById("panelInfo").innerText = "Server ID: " + id;

  document.getElementById("playerPanel").classList.add("active");
}

function closePanel(){
  document.getElementById("playerPanel").classList.remove("active");
}

/* ================= ACTION SYSTEM ================= */
async function sendAction(type, payload){
  try{
    const res = await fetch(API + "/api/dashboard/action", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
        token,
        license_key: licenseKey,
        type,
        payload
      })
    });

    const data = await res.json();
    if(!res.ok) throw new Error(data.message || "Backend error");

    return true;
  }catch(e){
    console.error(e);
    alert("Backend error");
    return false;
  }
}

/* ================= KICK ================= */
async function openKick(){
  if(!selectedPlayer) return;

  const reason = prompt("Anledning fÃ¶r kick:");
  if(!reason) return;

  const ok = await sendAction("kick", {
    player: selectedPlayer,
    reason
  });

  if(ok) alert("Kick skickad âœ…");
  closePanel();
}

/* ================= BAN ================= */
async function openBan(){
  if(!selectedPlayer) return;

  const reason = prompt("Anledning fÃ¶r ban:");
  if(!reason) return;

  const duration = prompt("Tid (30m, 2h, 7d, P):");
  if(!duration) return;

  const ok = await sendAction("ban", {
    player: selectedPlayer,
    reason,
    duration
  });

  if(ok) alert("Ban skickad âœ…");
  closePanel();
}

/* ================= DM ================= */
async function openDM(){
  if(!selectedPlayer) return;

  const message = prompt("Skriv DM:");
  if(!message) return;

  const ok = await sendAction("dm", {
    player: selectedPlayer,
    message
  });

  if(ok) alert("DM skickad âœ…");
  closePanel();
}

/* ================= AUTO REFRESH ================= */
setInterval(fetchPlayers, 3000);
fetchPlayers();
</script>

</script>

</body>
</html>

