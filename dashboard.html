<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<title>GhostGuard Panel</title>

<style>
:root{
  --bg-dark:#060c18;
  --bg-card:#101a2e;
  --bg-light:#0a1222;
  --card-dark:#101a2e;
  --card-light:#0d1628;
  --blue:#3b82f6;
  --blue-glow:rgba(59,130,246,.4);
  --blue-hover:rgba(59,130,246,.15);
  --blue-active:rgba(59,130,246,.25);
  --red:#ef4444;
  --yellow:#f59e0b;
  --green:#22c55e;
  --border:rgba(255,255,255,.06);
  --text:#e6f0ff;
  --text-muted:rgba(230,240,255,.6);
}

*{box-sizing:border-box}
html, body { height: 100%; }
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:radial-gradient(circle at 20% 0%, #0f1f3d, var(--bg-dark));
  color:var(--text);
  display:flex;
  min-height:100vh;
  height:100%;
  animation:fadeIn .35s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.5; }
  100% { opacity: 1; }
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* SIDEBAR */
.sidebar{
  width:240px;
  background:linear-gradient(180deg,#0b1426,var(--bg-light));
  padding:30px 20px;
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
  height:100vh;
  box-shadow: inset -1px 0 0 rgba(255,255,255,.01);
  position:sticky;
  top:0;
}

.logo{
  font-size:22px;
  font-weight:900;
  margin-bottom:35px;
}

.nav{
  padding:12px 14px;
  border-radius:10px;
  cursor:pointer;
  margin-bottom:10px;
  color:var(--text-muted);
  transition:.2s;
  display:flex;
  align-items:center;
  gap:10px;
}

.nav:hover{background:var(--blue-hover);color:white;}
.nav.active{background:var(--blue-active);color:white;}

.content{
  flex:1 1 auto;
  padding:40px;
  min-height:100vh;
  height:100%;
  overflow:auto;
  display:flex;
  flex-direction:column;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:25px;
}

.content > div {
  flex:1 1 auto;
  display:flex;
  flex-direction:column;
}
.content .grid{
  flex:0 0 auto;
}

.card{
  background:linear-gradient(180deg,var(--card-dark),var(--card-light));
  border-radius:16px;
  padding:25px;
  border:1px solid var(--border);
  box-shadow:0 22px 70px rgba(0,0,0,.35);
  transition:.2s ease;
}

.card:hover{
  transform:translateY(-2px);
  border-color:var(--blue-glow);
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: .5; }
  100% { opacity: 1; }
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.online-dot { animation:pulse 2s infinite; }

.skeleton {
  background: linear-gradient(90deg, var(--bg-card) 25%, var(--bg-dark) 50%, var(--bg-card) 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

/* PLAYER CARD */
.player-card{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:15px;
  border-radius:12px;
  background:rgba(59,130,246,.08);
  margin-bottom:10px;
  border:1px solid transparent;
  transition:.2s;
}

.player-card:hover{
  background:rgba(59,130,246,.18);
  border-color:var(--blue-glow);
  transform:translateY(-1px);
}

.player-info{
  display:flex;
  flex-direction:column;
}

.player-name{font-weight:800}
.player-id{font-size:12px;color:var(--text-muted)}

.player-actions{
  display:flex;
  gap:8px;
}

.btn{
  padding:8px 12px;
  border-radius:10px;
  font-size:12px;
  font-weight:700;
  border:1px solid var(--border);
  cursor:pointer;
  color:var(--text);
  background:rgba(255,255,255,.05);
  transition:.2s;
}

.btn:hover{transform:translateY(-1px);border-color:var(--blue-glow)}
.btn-primary{background:var(--blue);border-color:transparent;color:#fff}
.btn-warning,.btn-kick{background:rgba(245,158,11,.2);border-color:rgba(245,158,11,.45);color:#ffdca0}
.btn-danger,.btn-ban{background:rgba(239,68,68,.2);border-color:rgba(239,68,68,.45);color:#ffc1c1}
.btn-ghost{background:rgba(255,255,255,.05)}

.status-online{color:var(--green);font-weight:800}
.status-offline{color:var(--red);font-weight:800}
.status-online::before,.status-offline::before{content:"";display:inline-block;width:8px;height:8px;border-radius:999px;margin-right:8px;animation:pulse 2s infinite}
.status-online::before{background:var(--green)}
.status-offline::before{background:var(--red)}

.skeleton {
  background: linear-gradient(90deg, var(--bg-card) 25%, var(--bg-dark) 50%, var(--bg-card) 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

.log-card{
  padding:12px 16px;
  border-radius:12px;
  margin-bottom:10px;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.06);
  transition:.2s;
}

.log-card:hover{
  background:rgba(59,130,246,.08);
  border-color:rgba(59,130,246,.3);
}

.log-header{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  margin-bottom:4px;
}

.log-time{
  color:rgba(230,240,255,.5);
}

.log-type{
  font-weight:700;
  padding:2px 8px;
  border-radius:20px;
  font-size:11px;
}


/* MODAL */
.modal-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
  backdrop-filter:blur(4px);
}

.modal{
  width:400px;
  background:linear-gradient(180deg,#0f1f3d,#0a162b);
  border:1px solid rgba(59,130,246,.4);
  border-radius:16px;
  padding:25px;
  box-shadow:0 0 40px rgba(59,130,246,.3);
}

.modal h3{
  margin-top:0;
  margin-bottom:15px;
}

.evidence-thumb{
  width:44px;
  height:44px;
  border-radius:8px;
  object-fit:cover;
  border:1px solid var(--border);
  cursor:pointer;
}

.evidence-preview{
  width:100%;
  border-radius:10px;
  border:1px solid var(--border);
}



  
.log-info{background:#1f2937;color:#93c5fd;}
.log-join{background:#052e1f;color:#22c55e;}
.log-leave{background:#2e1a05;color:#f59e0b;}
.log-ban{background:#3b0a0a;color:#ef4444;}
.log-detect{background:#1e1b4b;color:#a78bfa;}

.log-message{
  font-size:13px;
  color:rgba(230,240,255,.85);
}



/* MODAL */
.modal-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
  backdrop-filter:blur(4px);
}

.modal{
  width:400px;
  background:linear-gradient(180deg,#0f1f3d,#0a162b);
  border:1px solid rgba(59,130,246,.4);
  border-radius:16px;
  padding:25px;
  box-shadow:0 0 40px rgba(59,130,246,.3);
}

.modal h3{
  margin-top:0;
  margin-bottom:15px;
}

.modal input{
  width:100%;
  padding:10px;
  margin-bottom:12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0c1426;
  color:white;
}

.modal input:focus{
  outline:none;
  border-color:var(--blue-glow);
  box-shadow:0 0 0 3px rgba(59,130,246,.2);
}

.content::after{
  content:'';
  display:block;
  flex:1 1 auto;
  background:linear-gradient(180deg, rgba(10,20,34,0.02), transparent 40%);
  margin-top:20px;
  border-radius:12px;
}

.modal-actions{
  display:flex;
  justify-content:flex-end;
  gap:10px;
}

.modal-btn{
  padding:8px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:700;
}

.modal-cancel{
  background:#1f2937;
  color:white;
}

.modal-confirm{
  background:#3b82f6;
  color:white;
}

  
</style>
</head>

<body>

  <div id="actionModal" style="display:none;"></div>


  
<div class="sidebar">
  <div class="logo"><i class="fas fa-ghost"></i> GhostGuard</div>
  <div class="nav active" onclick="showView('dashboard', this)"><i class="fas fa-chart-line"></i><span>Dashboard</span></div>
  <div class="nav" onclick="showView('players', this)"><i class="fas fa-users"></i><span>Players</span></div>
  <div class="nav" onclick="showView('logs', this)"><i class="fas fa-scroll"></i><span>Server Logs</span></div>
  <div class="nav" onclick="showView('bans', this)"><i class="fas fa-ban"></i><span>Ban List</span></div>
  <div class="nav" onclick="showView('download', this)"><i class="fas fa-download"></i><span>Download</span></div>
</div>

<div class="content">


  
<div id="dashboardView">
  <div class="grid">
    <div class="card">
      <h3>License</h3>
      <p>Status: <span id="licenseStatus">Loading...</span></p>
      <p>Expires: <span id="licenseExpire">-</span></p>
    </div>

    <div class="card">
      <h3>Server</h3>
      <p>Status: <span id="serverStatus">Loading...</span></p>
      <p>Players: <span id="playerCountDash">0</span></p>
    </div>
  </div>
</div>

<div id="bansView" style="display:none;">
  <div class="card">
    <h3>Banned Players</h3>
    <div id="banList"></div>
  </div>
</div>
  
<div id="playersView" style="display:none;">
  <div class="card">
    <h3>Online Players</h3>
    <div id="playerList"></div>
  </div>
</div>

<div id="logsView" style="display:none;">
  <div class="card">
    <h3>Live Logs</h3>
    <div id="logList"></div>
  </div>
</div>


<div id="downloadView" style="display:none;">
  <div class="card">
    <h3><i class="fas fa-download"></i> GhostGuard Download Center</h3>

    <p><b>Current Version:</b> v3.1.0</p>
    <p><b>Status:</b> <span class="status-online" style="color: var(--green);">Stable</span></p>

    <br>

    <a href="https://drive.google.com/file/d/1Ayg8qnk5fuR4UrjgiIFdsW8veqLH4IS6/view"
       target="_blank"
       style="
         display:inline-block;
         padding:12px 20px;
         background:#3b82f6;
         color:white;
         border-radius:10px;
         text-decoration:none;
         font-weight:700;
       ">
       <i class="fas fa-download"></i> Download GhostGuard
    </a>

    <hr style="margin:30px 0; opacity:.1">

    <h4><i class="fas fa-cog"></i> Installation Guide</h4>

    <p>1️⃣ Download the zip file</p>
    <p>2️⃣ Extract the folder</p>
    <p>3️⃣ Move folder to:</p>
    <pre>resources/[ghostguard]/</pre>

    <p>4️⃣ Add to server.cfg:</p>
    <pre>ensure ghostguard</pre>

    <p>5️⃣ Open config.lua and set:</p>
    <pre>
Config.LicenseKey = "DIN_LICENSE_KEY"
    </pre>

    <p>6️⃣ Restart server</p>

  </div>
</div>

  
</div>

<script>
const API="https://ghostgaurd-becakd.onrender.com";
const licenseKey=localStorage.getItem("gg_license_key")||"";
const token=localStorage.getItem("gg_token")||"";
let cachedBans = [];

function escapeHtml(value){
  return String(value ?? "")
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/\"/g, "&quot;")
    .replace(/'/g, "&#39;");
}

function isViewActive(viewId){
  const el = document.getElementById(viewId);
  return !!el && el.style.display !== "none";
}

function showView(view, el){
  document.querySelectorAll(".nav").forEach(n=>n.classList.remove("active"));
  el.classList.add("active");

  document.getElementById("dashboardView").style.display="none";
  document.getElementById("playersView").style.display="none";
  document.getElementById("logsView").style.display="none";
  document.getElementById("bansView").style.display="none"; // ← DENNA SAKNADES
  document.getElementById("downloadView").style.display="none";

  document.getElementById(view+"View").style.display="block";

  if(view === "dashboard") fetchServer();
  if(view === "players") fetchPlayers();
  if(view === "logs") fetchLogs();
  if(view === "bans") fetchBans();
}


async function fetchLicense(){
  if(!token) return;
  try{
    const res=await fetch(API+"/customer/dashboard",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({token})
    });
    const data=await res.json();
    if(data.success){
      document.getElementById("licenseStatus").innerText=data.data.status;
      document.getElementById("licenseExpire").innerText=
        data.data.expires_at?new Date(data.data.expires_at).toLocaleString():"Lifetime";
    }
  }catch(e){console.log(e);}
}

async function fetchServer(){
  try{
    const res=await fetch(API+"/api/server/status/"+licenseKey);
    const data=await res.json();
    document.getElementById("serverStatus").innerText=data.online?"Online":"Offline";
    document.getElementById("serverStatus").className=data.online?"status-online":"status-offline";
    document.getElementById("playerCountDash").innerText=data.players||0;
  }catch(e){console.log(e);}
}

async function fetchPlayers(){
  if(!isViewActive("playersView")) return;
  try{
    const res=await fetch(API+"/api/server/players/"+licenseKey);
    const data=await res.json();
    const players=data.players||[];

    document.getElementById("playerList").innerHTML=players.map(p=>`
      <div class="player-card">
        <div class="player-info">
          <span class="player-name">${escapeHtml(p.name)}</span>
          <span class="player-id">ID: ${escapeHtml(p.id)}</span>
        </div>
        <div class="player-actions">
      <button class="btn btn-kick" onclick="openModal('kick', ${p.id})"><i class="fas fa-user-slash"></i> Kick</button>
    <button class="btn btn-ban" onclick="openModal('ban', ${p.id})"><i class="fas fa-gavel"></i> Ban</button>
        </div>
      </div>
    `).join("");
  }catch(e){console.log(e);}
}

async function fetchLogs(){
  if(!isViewActive("logsView")) return;
  try{
    const res=await fetch(API+"/api/server/logs/"+licenseKey);
    const data=await res.json();
    const logs=(data.data||[]).slice(0,50);

    document.getElementById("logList").innerHTML = logs.map(l=>{
      
      let typeClass="log-info";
      let typeLabel="INFO";

      const msg=(l.message||"").toLowerCase();

      if(msg.includes("joined")){
        typeClass="log-join";
        typeLabel="JOIN";
      }
      else if(msg.includes("left")){
        typeClass="log-leave";
        typeLabel="LEAVE";
      }
      else if(msg.includes("ban")){
        typeClass="log-ban";
        typeLabel="BAN";
      }
      else if(msg.includes("explosion") || msg.includes("speed") || msg.includes("noclip")){
        typeClass="log-detect";
        typeLabel="DETECTION";
      }

      return `
        <div class="log-card">
          <div class="log-header">
            <span class="log-time">${escapeHtml(new Date(l.time).toLocaleTimeString())}</span>
            <span class="log-type ${typeClass}">${typeLabel}</span>
          </div>
          <div class="log-message">${escapeHtml(l.message)}</div>
        </div>
      `;
    }).join("");

  }catch(e){
    console.log(e);
  }
}


async function send(type, payload){
  try{
    const res = await fetch(API + "/api/dashboard/action", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        token,
        type,
        payload
      })
    });

    const data = await res.json();
    return data.success;
  }catch(e){
    console.log("SEND ERROR:", e);
    return false;
  }
}

  
/* ===== MODAL LOGIC (ADDED, DOES NOT REMOVE ANYTHING) ===== */

function openModal(type, playerId){
  const modal = document.getElementById("actionModal");

  modal.innerHTML = `
    <div class="modal-overlay">
      <div class="modal">
        <h3>${type === "kick" ? "Kick Player" : "Ban Player"}</h3>

        <input id="reasonInput" placeholder="Reason..." />

        ${type === "ban" ? `<input id="durationInput" placeholder="Duration (30m,2h,7d,P)" />` : ""}

        <div class="modal-actions">
          <button class="modal-btn modal-cancel" onclick="closeModal()">Cancel</button>
          <button class="modal-btn modal-confirm" onclick="confirmAction('${type}', ${playerId})">
            Confirm
          </button>
        </div>
      </div>
    </div>
  `;

  modal.style.display = "block";
}

function closeModal(){
  document.getElementById("actionModal").style.display = "none";
}

async function confirmAction(type, playerId){
  const reason = document.getElementById("reasonInput").value;
  if(!reason){
    alert("Reason required");
    return;
  }

  let payload = { player: playerId, reason };

  if(type === "ban"){
    const duration = document.getElementById("durationInput").value;
    if(!duration){
      alert("Duration required");
      return;
    }
    payload.duration = duration;
  }

  // använder din befintliga send()
  const ok = await send(type, payload);

  if(ok){
    closeModal();
  }
}


async function fetchBans(){
  if(!isViewActive("bansView")) return;
  try{
    const res = await fetch(API + "/api/server/bans/" + licenseKey);
    const data = await res.json();
    const bans = data.data || [];
    cachedBans = bans;

    document.getElementById("banList").innerHTML = bans.map((b, idx)=>`
  <div class="player-card">
    <div class="player-info">
      <span class="player-name">${escapeHtml(b.player_id)}</span>
      <span class="player-id">Ban ID: ${escapeHtml(b.ban_id)}</span>
    </div>

    <div class="player-actions">
      ${b.evidence_url ? `<img class="evidence-thumb" src="${encodeURI(b.evidence_url)}" alt="evidence" onclick="previewEvidence(${idx})"/>` : ""}

      <button class="btn btn-kick"
        onclick="showBanInfo(${idx})">
        <i class="fas fa-info-circle"></i> Info
      </button>

      <button class="btn btn-ban"
        onclick="unbanPlayer('${encodeURIComponent(b.ban_id || "")}')">
        <i class="fas fa-check-circle"></i> Unban
      </button>

    </div>
  </div>
`).join("");


  }catch(e){console.log(e);}
}

async function unbanPlayer(banId){

  if(!confirm("Är du säker att du vill unbanna denna spelare?")) return;

  try{
    const res = await fetch(API + "/api/server/unban/" + decodeURIComponent(banId), {
      method: "DELETE",
      headers: {
        "Authorization": `Bearer ${token}`
      }
    });

    const data = await res.json();

    if(data.success){
      fetchBans();
    }else{
      alert("Unban failed");
    }

  }catch(e){
    console.log(e);
  }
}

  
function showBanInfo(index){
  const b = cachedBans[index];
  if(!b) return;
  const modal = document.getElementById("actionModal");

  modal.innerHTML = `
    <div class="modal-overlay">
      <div class="modal">
        <h3>Ban Info</h3>
        <p><b>Ban ID:</b> ${escapeHtml(b.ban_id)}</p>
        <p><b>Reason:</b> ${escapeHtml(b.reason)}</p>
        <p><b>Duration:</b> ${escapeHtml(b.duration || "P")}</p>
        <p><b>By:</b> ${escapeHtml(b.banned_by || "GhostGuard")}</p>
        <p><b>Expiry:</b> ${escapeHtml(b.expires_at ? new Date(b.expires_at).toLocaleString() : "PERMANENT")}</p>
        <p><b>Date:</b> ${escapeHtml(new Date(b.created_at).toLocaleString())}</p>
        <div class="modal-actions">
          <button class="modal-btn modal-cancel" onclick="closeModal()">Close</button>
        </div>
      </div>
    </div>
  `;
    
  modal.style.display = "block";
}

function previewEvidence(index){
  const b = cachedBans[index];
  if(!b || !b.evidence_url) return;

  const modal = document.getElementById("actionModal");
  modal.innerHTML = `
    <div class="modal-overlay">
      <div class="modal">
        <h3>Evidence Preview</h3>
        <img class="evidence-preview" src="${encodeURI(b.evidence_url)}" alt="evidence" />
        <div class="modal-actions">
          <button class="modal-btn modal-cancel" onclick="closeModal()">Close</button>
        </div>
      </div>
    </div>
  `;

  modal.style.display = "block";
}




  
setInterval(()=>{ if(isViewActive("bansView")) fetchBans(); }, 5000);
setInterval(()=>{ if(isViewActive("dashboardView")) fetchServer(); },5000);
setInterval(()=>{ if(isViewActive("playersView")) fetchPlayers(); },3000);
setInterval(()=>{ if(isViewActive("logsView")) fetchLogs(); },3000);

fetchLicense();
fetchServer();
fetchPlayers();
fetchLogs();
fetchBans(); // ← lägg till denna

  
</script>

</body>
</html>











