<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GhostGuard Panel</title>

<style>
:root{
  --bg:#060b18;
  --sidebar:#0c1426;
  --card:#111c33;
  --border:rgba(255,255,255,.08);
  --blue:#3b82f6;
  --green:#22c55e;
  --red:#ef4444;
  --yellow:#f59e0b;
  --text:#e6f0ff;
  --muted:rgba(230,240,255,.6);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Arial,system-ui,sans-serif;
  background:radial-gradient(900px 500px at 50% 0%, rgba(59,130,246,.15), transparent 60%), var(--bg);
  color:var(--text);
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:230px;
  background:linear-gradient(180deg, rgba(12,20,38,.95), rgba(12,20,38,.85));
  min-height:100vh;
  padding:20px 15px;
  border-right:1px solid var(--border);
}

.logo{
  font-weight:900;
  font-size:18px;
  margin-bottom:22px;
  display:flex;
  align-items:center;
  gap:10px;
}
.logo span{opacity:.85;font-weight:800;font-size:12px}

.nav-item{
  padding:12px 14px;
  border-radius:10px;
  margin-bottom:8px;
  cursor:pointer;
  color:var(--muted);
  user-select:none;
}
.nav-item:hover{
  background:rgba(59,130,246,.15);
  color:var(--text);
}
.nav-item.active{
  background:rgba(59,130,246,.25);
  color:var(--text);
}

/* CONTENT */
.content{
  flex:1;
  padding:26px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:18px;
}

.card{
  background:linear-gradient(180deg, rgba(17,28,51,.95), rgba(17,28,51,.78));
  padding:18px;
  border-radius:14px;
  border:1px solid var(--border);
  box-shadow:0 18px 70px rgba(0,0,0,.35);
}
.card-title{
  font-weight:900;
  font-size:16px;
  margin-bottom:12px;
}

.row{display:flex;justify-content:space-between;gap:10px; padding:6px 0; border-bottom:1px solid rgba(255,255,255,.05)}
.row:last-child{border-bottom:none}
.k{color:var(--muted);font-size:12px;font-weight:800}
.v{font-weight:800}

.status-online{color:var(--green);font-weight:900}
.status-offline{color:var(--red);font-weight:900}
.status-warn{color:var(--yellow);font-weight:900}

.hidden{display:none}

/* PLAYERS */
.player-row{
  display:flex;
  justify-content:space-between;
  padding:12px 14px;
  border-bottom:1px solid rgba(255,255,255,.06);
  cursor:pointer;
  transition:.18s;
}
.player-row:hover{ background:rgba(59,130,246,.10); }
.player-name{font-weight:900}
.player-sub{font-size:12px;color:var(--muted);margin-top:2px}
.arrow{opacity:.6;font-weight:900}

/* LOGS */
.logBox{
  max-height:520px;
  overflow:auto;
  font-size:13px;
}
.logRow{
  padding:8px 0;
  border-bottom:1px solid rgba(255,255,255,.06);
}
.small{color:var(--muted);font-size:12px}

/* SIDE PANEL */
.side-panel{
  position:fixed;
  right:-420px;
  top:0;
  width:400px;
  height:100%;
  background:linear-gradient(180deg, rgba(15,23,42,.98), rgba(15,23,42,.92));
  border-left:1px solid var(--border);
  padding:22px;
  transition:.26s ease;
  z-index:1000;
  box-shadow:-30px 0 70px rgba(0,0,0,.35);
}
.side-panel.active{ right:0; }

.panel-title{
  font-size:18px;
  font-weight:900;
  margin-bottom:6px;
}
.panel-info{color:var(--muted);font-size:12px;margin-bottom:16px}

.action-btn{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  font-weight:900;
  background:rgba(255,255,255,.06);
  color:var(--text);
  border:1px solid rgba(255,255,255,.10);
}
.action-btn:hover{filter:brightness(1.06)}
.btn-kick{ background:rgba(245,158,11,.12); border-color:rgba(245,158,11,.22); color:#ffd48a;}
.btn-ban{ background:rgba(239,68,68,.12); border-color:rgba(239,68,68,.22); color:#ffb3b3;}
.btn-dm{ background:rgba(59,130,246,.12); border-color:rgba(59,130,246,.22); color:#bcd6ff;}

.close-btn{
  margin-top:14px;
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  color:var(--text);
  cursor:pointer;
  font-weight:900;
}

.toast{
  position:fixed;
  left:50%;
  bottom:18px;
  transform:translateX(-50%);
  background:rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.12);
  padding:10px 14px;
  border-radius:12px;
  color:var(--text);
  font-size:13px;
  display:none;
  z-index:1200;
}
.toast.show{display:block}

/* ================= NEW: ADMINS UI ================= */
.admin-top{
  display:flex;
  gap:14px;
  align-items:flex-start;
  flex-wrap:wrap;
}
.admin-form{
  flex:1;
  min-width:260px;
}
.admin-list{
  flex:1;
  min-width:320px;
}
.input{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.04);
  color:var(--text);
  outline:none;
  font-weight:800;
  margin-bottom:10px;
}
.input::placeholder{ color:rgba(230,240,255,.45); font-weight:700; }

.btn{
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  color:var(--text);
  cursor:pointer;
  font-weight:900;
}
.btn:hover{filter:brightness(1.06)}
.btn-blue{ background:rgba(59,130,246,.14); border-color:rgba(59,130,246,.24); color:#cfe2ff;}
.btn-red{ background:rgba(239,68,68,.14); border-color:rgba(239,68,68,.24); color:#ffd0d0;}
.btn-green{ background:rgba(34,197,94,.14); border-color:rgba(34,197,94,.24); color:#d3ffdf;}
.btn-small{ padding:8px 10px; border-radius:10px; font-size:12px; }

.table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  overflow:hidden;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
}
.table th, .table td{
  padding:10px 10px;
  border-bottom:1px solid rgba(255,255,255,.06);
  text-align:left;
  font-size:13px;
}
.table th{
  font-size:12px;
  color:var(--muted);
  font-weight:900;
  background:rgba(255,255,255,.03);
}
.table tr:last-child td{ border-bottom:none; }
.badge{
  display:inline-block;
  padding:4px 8px;
  border-radius:999px;
  font-size:11px;
  font-weight:900;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
}
.badge-on{ color:#d3ffdf; border-color:rgba(34,197,94,.25); background:rgba(34,197,94,.12);}
.badge-off{ color:#ffd0d0; border-color:rgba(239,68,68,.25); background:rgba(239,68,68,.12);}

.inviteBox{
  margin-top:10px;
  padding:12px;
  border-radius:12px;
  border:1px dashed rgba(255,255,255,.18);
  background:rgba(255,255,255,.04);
}
.inviteRow{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
}
.code{
  font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size:12px;
  font-weight:900;
  opacity:.95;
  user-select:text;
  word-break:break-all;
}
</style>
</head>

<body>

<!-- RIGHT PLAYER PANEL -->
<div id="playerPanel" class="side-panel">
  <div class="panel-title" id="panelPlayerName">Player</div>
  <div class="panel-info" id="panelInfo">-</div>

  <button class="action-btn btn-kick" onclick="openKick()">Kick</button>
  <button class="action-btn btn-ban" onclick="openBan()">Ban</button>
  <button class="action-btn btn-dm" onclick="openDM()">Send DM</button>

  <button class="close-btn" onclick="closePanel()">Close</button>
</div>

<div class="toast" id="toast"></div>

<div class="sidebar">
  <div class="logo">üëª GhostGuard <span>Panel</span></div>
  <div class="nav-item active" onclick="showView('dashboard',this)">Dashboard</div>
  <div class="nav-item" onclick="showView('players',this)">Players</div>
  <div class="nav-item" onclick="showView('logs',this)">Server Logs</div>

  <!-- NEW: ADMINS NAV -->
  <div class="nav-item" onclick="showView('admins',this); refreshAdmins(true)">Admins</div>
</div>

<div class="content">

  <!-- DASHBOARD -->
  <div id="dashboardView">
    <div class="grid">

      <div class="card">
        <div class="card-title">License Info</div>
        <div class="row"><div class="k">Key</div><div class="v" id="license-key">-</div></div>
        <div class="row"><div class="k">Status</div><div class="v" id="license-status">-</div></div>
        <div class="row"><div class="k">Expires</div><div class="v" id="license-expire">-</div></div>
        <div class="row"><div class="k">Time left</div><div class="v" id="license-left">-</div></div>
      </div>

      <div class="card">
        <div class="card-title">Server Status</div>
        <div class="row"><div class="k">Status</div><div class="v" id="server-status">Loading...</div></div>
        <div class="row"><div class="k">Players</div><div class="v" id="players-count">0</div></div>
        <div class="row"><div class="k">Version</div><div class="v" id="server-version">-</div></div>
        <div class="row"><div class="k">Uptime</div><div class="v" id="server-uptime">0s</div></div>
      </div>

    </div>
  </div>

  <!-- PLAYERS -->
  <div id="playersView" class="hidden">
    <div class="card">
      <div class="card-title">Online Players</div>
      <div id="players-list"></div>
    </div>
  </div>

  <!-- LOGS -->
  <div id="logsView" class="hidden">
    <div class="card">
      <div class="card-title">Live Server Logs</div>
      <div id="logs-box" class="logBox"></div>
    </div>
  </div>

  <!-- ================= NEW: ADMINS VIEW ================= -->
  <div id="adminsView" class="hidden">
    <div class="card">
      <div class="card-title">Admin Access</div>

      <div class="admin-top">

        <!-- Add admin form -->
        <div class="admin-form">
          <div style="font-weight:900;margin-bottom:10px;">‚ûï Add Admin</div>

          <input id="adminName" class="input" placeholder="Namn (t.ex. Alex)"/>
          <input id="adminSteam" class="input" placeholder="Steam identifier (t.ex. steam:11000010xxxxxxx)"/>
          <input id="adminDiscord" class="input" placeholder="Discord (valfritt) (t.ex. 1234567890)"/>

          <button class="btn btn-blue" onclick="addAdmin()">Create Admin</button>

          <div id="inviteBox" class="inviteBox hidden">
            <div style="font-weight:900;margin-bottom:8px;">Invite Token (visa bara 1 g√•ng)</div>
            <div class="inviteRow">
              <div class="code" id="inviteTokenText">-</div>
              <button class="btn btn-small" onclick="copyInvite()">Copy</button>
            </div>
            <div class="small" style="margin-top:8px;">
              Adminen loggar in med denna token (spara den direkt).
            </div>
          </div>
        </div>

        <!-- Admin list -->
        <div class="admin-list">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:10px;">
            <div style="font-weight:900;">üëÆ Admins with access</div>
            <button class="btn btn-small" onclick="refreshAdmins(true)">Refresh</button>
          </div>

          <div id="adminsTableWrap">
            <div style="opacity:.6">Loading...</div>
          </div>
        </div>

      </div>
    </div>
  </div>
  <!-- ================= END ADMINS VIEW ================= -->

</div>

<script>
const API = "https://ghostgaurd-becakd.onrender.com";
const licenseKey = localStorage.getItem("gg_license_key") || "";
let selectedPlayer = null;

/* toast */
function toast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"), 1600);
}

/* VIEW SWITCH */
function showView(view, el){
  document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
  el.classList.add("active");

  // UPDATED: include admins
  ["dashboard","players","logs","admins"].forEach(v=>{
    const node = document.getElementById(v+"View");
    if(node) node.classList.add("hidden");
  });
  const target = document.getElementById(view+"View");
  if(target) target.classList.remove("hidden");
}

/* HELPERS */
function formatUptime(s){
  const h=Math.floor(s/3600);
  const m=Math.floor((s%3600)/60);
  const sec=s%60;
  return `${h}h ${m}m ${sec}s`;
}

function calcTimeLeft(expiresAt){
  if(!expiresAt) return "Lifetime";
  const exp = new Date(expiresAt);
  const now = new Date();
  if(exp <= now) return "Expired";
  const diff = exp - now;
  const days = Math.floor(diff / (1000*60*60*24));
  const hours = Math.floor((diff / (1000*60*60)) % 24);
  const minutes = Math.floor((diff / (1000*60)) % 60);
  return `${days}d ${hours}h ${minutes}m`;
}

/* PLAYERS */
async function fetchPlayers(){
  if(!licenseKey){
    document.getElementById("players-list").innerHTML =
      "<div style='opacity:.6'>Ingen license key i localStorage (gg_license_key)</div>";
    return;
  }

  let data;
  try{
    const res = await fetch(API + "/api/server/players/" + encodeURIComponent(licenseKey));
    data = await res.json();
  }catch(e){
    document.getElementById("players-list").innerHTML =
      "<div style='opacity:.6'>Kunde inte h√§mta players (network fel)</div>";
    return;
  }

  const list = data.players || [];
  const container = document.getElementById("players-list");

  if(list.length === 0){
    container.innerHTML = "<div style='opacity:.6'>Inga spelare online</div>";
    return;
  }

  container.innerHTML = list.map(p=>{
    const safeName = encodeURIComponent(p.name ?? "Unknown");
    const id = Number(p.id || 0);
    const ping = Number(p.ping || 0);
    return `
      <div class="player-row" onclick="openPlayerPanel(${id}, decodeURIComponent('${safeName}'), ${ping})">
        <div>
          <div class="player-name">${p.name ?? "Unknown"}</div>
          <div class="player-sub">ID: ${id} ‚Ä¢ Ping: ${ping}</div>
        </div>
        <div class="arrow">‚Üí</div>
      </div>
    `;
  }).join("");
}

function openPlayerPanel(id,name,ping){
  selectedPlayer = id;
  document.getElementById("panelPlayerName").innerText = name;
  document.getElementById("panelInfo").innerText = `ID: ${id} ‚Ä¢ Ping: ${ping}`;
  document.getElementById("playerPanel").classList.add("active");
}

function closePanel(){
  document.getElementById("playerPanel").classList.remove("active");
}

/* ACTIONS -> backend */
async function sendAction(type, payload){
  const token = localStorage.getItem("gg_token") || "";
  const res = await fetch(API + "/api/dashboard/action", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ token, license_key: licenseKey, type, payload })
  });

  // visa tydligt om det √§r 404 html osv
  const text = await res.text();
  let json = null;
  try{ json = JSON.parse(text); }catch{}

  if(!res.ok){
    console.error("Action failed", res.status, text);
    throw new Error(`Backend error ${res.status}`);
  }
  return json || { success:true };
}

async function openKick(){
  if(!selectedPlayer) return toast("V√§lj en player f√∂rst");
  const reason = prompt("Anledning f√∂r kick?");
  if(!reason) return;
  try{
    await sendAction("kick", { player: selectedPlayer, reason });
    toast("Kick skickad ‚úÖ");
  }catch(e){
    toast("Kick fail ‚ùå (kolla Console)");
  }
  closePanel();
}

async function openBan(){
  if(!selectedPlayer) return toast("V√§lj en player f√∂rst");
  const reason = prompt("Anledning f√∂r ban?");
  if(!reason) return;
  const time = prompt("Tid (30m, 2h, 7d, P)?");
  if(!time) return;
  try{
    await sendAction("ban", { player: selectedPlayer, reason, duration: time });
    toast("Ban skickad ‚úÖ");
  }catch(e){
    toast("Ban fail ‚ùå (kolla Console)");
  }
  closePanel();
}

async function openDM(){
  if(!selectedPlayer) return toast("V√§lj en player f√∂rst");
  const message = prompt("Skriv DM till spelaren:");
  if(!message) return;
  try{
    await sendAction("dm", { player: selectedPlayer, message });
    toast("DM skickad ‚úÖ");
  }catch(e){
    toast("DM fail ‚ùå (kolla Console)");
  }
  closePanel();
}

/* LICENSE */
async function fetchLicense(){
  const token = localStorage.getItem("gg_token") || "";

  if(!token){
    document.getElementById("license-key").innerText = "-";
    document.getElementById("license-status").innerText = "NO SESSION";
    document.getElementById("license-status").className = "status-warn";
    document.getElementById("license-expire").innerText = "-";
    document.getElementById("license-left").innerText = "-";
    return;
  }

  const res = await fetch(API + "/customer/dashboard", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ token })
  });

  const text = await res.text();
  let data = null;
  try{ data = JSON.parse(text); }catch{}

  if(!data || !data.success){
    console.error("License fetch fail", res.status, text);
    document.getElementById("license-status").innerText = "ERROR";
    document.getElementById("license-status").className = "status-offline";
    return;
  }

  const lic = data.data;

  document.getElementById("license-key").innerText = lic.license_key || "-";

  const statusEl = document.getElementById("license-status");
  statusEl.innerText = lic.status || "UNKNOWN";
  statusEl.className =
    (lic.status === "ACTIVE") ? "status-online" :
    (lic.status === "DISABLED" || lic.status === "EXPIRED") ? "status-offline" :
    "status-warn";

  document.getElementById("license-expire").innerText =
    lic.expires_at ? new Date(lic.expires_at).toLocaleString() : "Lifetime";

  document.getElementById("license-left").innerText =
    calcTimeLeft(lic.expires_at || null);
}

/* SERVER STATUS */
async function fetchServerStatus(){
  if(!licenseKey){
    document.getElementById("server-status").innerText = "No license key";
    document.getElementById("server-status").className = "status-warn";
    return;
  }

  const res = await fetch(API + "/api/server/status/" + encodeURIComponent(licenseKey));
  const data = await res.json();

  const online = !!data.online;
  const el = document.getElementById("server-status");
  el.innerText = online ? "Online" : "Offline";
  el.className = online ? "status-online" : "status-offline";

  document.getElementById("players-count").innerText = data.players ?? 0;
  document.getElementById("server-version").innerText = data.version ?? "-";
  document.getElementById("server-uptime").innerText = formatUptime(data.uptime ?? 0);
}

/* LOGS */
function escapeHtml(s){
  return String(s ?? "").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m]));
}
async function fetchLogs(){
  if(!licenseKey) return;
  const res = await fetch(API + "/api/server/logs/" + encodeURIComponent(licenseKey));
  const data = await res.json();
  const logs = data.data || [];

  document.getElementById("logs-box").innerHTML =
    logs.slice(0,80).map(l=>`
      <div class="logRow">
        <div class="small">${new Date(l.time).toLocaleTimeString()}</div>
        <div>${escapeHtml(l.message)}</div>
      </div>
    `).join("");
}

/* ================= NEW: ADMINS ================= */
let adminsCache = [];
let lastInviteToken = "";

function showInvite(token){
  lastInviteToken = token || "";
  const box = document.getElementById("inviteBox");
  const txt = document.getElementById("inviteTokenText");
  if(!token){
    box.classList.add("hidden");
    txt.textContent = "-";
    return;
  }
  txt.textContent = token;
  box.classList.remove("hidden");
}

async function copyInvite(){
  if(!lastInviteToken) return toast("Ingen token");
  try{
    await navigator.clipboard.writeText(lastInviteToken);
    toast("Kopierad ‚úÖ");
  }catch(e){
    // fallback
    const t = document.createElement("textarea");
    t.value = lastInviteToken;
    document.body.appendChild(t);
    t.select();
    document.execCommand("copy");
    document.body.removeChild(t);
    toast("Kopierad ‚úÖ");
  }
}

function renderAdminsTable(){
  const wrap = document.getElementById("adminsTableWrap");
  if(!wrap) return;

  if(!adminsCache || adminsCache.length === 0){
    wrap.innerHTML = "<div style='opacity:.6'>Inga admins √§nnu</div>";
    return;
  }

  wrap.innerHTML = `
    <table class="table">
      <thead>
        <tr>
          <th>Namn</th>
          <th>Steam</th>
          <th>Discord</th>
          <th>Status</th>
          <th style="width:220px;">Actions</th>
        </tr>
      </thead>
      <tbody>
        ${adminsCache.map(a=>{
          const steam = a.steam ? escapeHtml(a.steam) : "-";
          const discord = a.discord ? escapeHtml(a.discord) : "-";
          const active = !!a.active;
          return `
            <tr>
              <td style="font-weight:900;">${escapeHtml(a.name || "Admin")}</td>
              <td class="small">${steam}</td>
              <td class="small">${discord}</td>
              <td>
                <span class="badge ${active ? "badge-on" : "badge-off"}">
                  ${active ? "Active" : "Disabled"}
                </span>
              </td>
              <td>
                <button class="btn btn-small ${active ? "" : "btn-green"}" onclick="toggleAdmin('${a.id}', ${!active})">
                  ${active ? "Disable" : "Enable"}
                </button>
                <button class="btn btn-small btn-red" style="margin-left:8px;" onclick="removeAdmin('${a.id}')">
                  Remove
                </button>
              </td>
            </tr>
          `;
        }).join("")}
      </tbody>
    </table>
  `;
}

async function refreshAdmins(showToast){
  const token = localStorage.getItem("gg_token") || "";
  if(!token){
    adminsCache = [];
    renderAdminsTable();
    if(showToast) toast("Ingen session token (gg_token)");
    return;
  }

  try{
    const res = await fetch(API + "/api/panel/admins/list", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ token })
    });

    const text = await res.text();
    let data=null; try{ data=JSON.parse(text);}catch{}
    if(!res.ok || !data || !data.success){
      console.error("Admins list fail", res.status, text);
      if(showToast) toast("Admins load fail ‚ùå");
      return;
    }

    adminsCache = data.data || [];
    renderAdminsTable();
    if(showToast) toast("Admins uppdaterade ‚úÖ");
  }catch(e){
    console.error("Admins list error", e);
    if(showToast) toast("Network fail ‚ùå");
  }
}

async function addAdmin(){
  const token = localStorage.getItem("gg_token") || "";
  if(!token) return toast("Ingen session token (gg_token)");

  const name = (document.getElementById("adminName").value || "").trim();
  const steam = (document.getElementById("adminSteam").value || "").trim();
  const discord = (document.getElementById("adminDiscord").value || "").trim();

  if(!name) return toast("Skriv namn");

  try{
    const res = await fetch(API + "/api/panel/admins/add", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ token, name, steam, discord })
    });

    const text = await res.text();
    let data=null; try{ data=JSON.parse(text);}catch{}
    if(!res.ok || !data || !data.success){
      console.error("Admins add fail", res.status, text);
      return toast("Create fail ‚ùå");
    }

    // show token once
    showInvite(data.invite_token || "");
    // clear inputs
    document.getElementById("adminName").value = "";
    document.getElementById("adminSteam").value = "";
    document.getElementById("adminDiscord").value = "";

    toast("Admin skapad ‚úÖ");
    await refreshAdmins(false);
  }catch(e){
    console.error("Admins add error", e);
    toast("Network fail ‚ùå");
  }
}

async function toggleAdmin(id, active){
  const token = localStorage.getItem("gg_token") || "";
  if(!token) return toast("Ingen session token");

  try{
    const res = await fetch(API + "/api/panel/admins/toggle", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ token, id, active })
    });

    const text = await res.text();
    let data=null; try{ data=JSON.parse(text);}catch{}
    if(!res.ok || !data || !data.success){
      console.error("Admins toggle fail", res.status, text);
      return toast("Toggle fail ‚ùå");
    }

    toast(active ? "Enabled ‚úÖ" : "Disabled ‚úÖ");
    await refreshAdmins(false);
  }catch(e){
    console.error("Admins toggle error", e);
    toast("Network fail ‚ùå");
  }
}

async function removeAdmin(id){
  const token = localStorage.getItem("gg_token") || "";
  if(!token) return toast("Ingen session token");

  if(!confirm("Ta bort admin?")) return;

  try{
    const res = await fetch(API + "/api/panel/admins/remove", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ token, id })
    });

    const text = await res.text();
    let data=null; try{ data=JSON.parse(text);}catch{}
    if(!res.ok || !data || !data.success){
      console.error("Admins remove fail", res.status, text);
      return toast("Remove fail ‚ùå");
    }

    toast("Borttagen ‚úÖ");
    await refreshAdmins(false);
  }catch(e){
    console.error("Admins remove error", e);
    toast("Network fail ‚ùå");
  }
}

/* AUTO REFRESH */
setInterval(fetchPlayers, 2500);
setInterval(fetchServerStatus, 5000);
setInterval(fetchLogs, 2500);
setInterval(fetchLicense, 15000);

// optional: refresh admins sometimes if you keep it open
setInterval(()=> {
  const adminsView = document.getElementById("adminsView");
  if(adminsView && !adminsView.classList.contains("hidden")){
    refreshAdmins(false);
  }
}, 12000);

fetchPlayers();
fetchLicense();
fetchServerStatus();
fetchLogs();
</script>
</body>
</html>
