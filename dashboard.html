<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GhostGuard Panel</title>

<style>
:root{
  --bg:#060b18;
  --sidebar:#0c1426;
  --card:#111c33;
  --border:rgba(255,255,255,.08);
  --blue:#3b82f6;
  --green:#22c55e;
  --red:#ef4444;
  --text:#e6f0ff;
  --muted:rgba(230,240,255,.6);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Arial;
  background:var(--bg);
  color:var(--text);
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:230px;
  background:var(--sidebar);
  min-height:100vh;
  padding:20px 15px;
  border-right:1px solid var(--border);
}

.logo{
  font-weight:900;
  font-size:18px;
  margin-bottom:30px;
}

.nav-item{
  padding:12px 14px;
  border-radius:10px;
  margin-bottom:8px;
  cursor:pointer;
  color:var(--muted);
}

.nav-item:hover{
  background:rgba(59,130,246,.15);
  color:var(--text);
}

.nav-item.active{
  background:rgba(59,130,246,.25);
  color:var(--text);
}

/* CONTENT */
.content{
  flex:1;
  padding:30px;
}

.card{
  background:var(--card);
  padding:20px;
  border-radius:14px;
  border:1px solid var(--border);
  margin-bottom:20px;
}

.card-title{
  font-weight:900;
  font-size:18px;
  margin-bottom:15px;
}

.status-online{color:var(--green);font-weight:bold}
.status-offline{color:var(--red);font-weight:bold}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:20px;
}

.hidden{display:none}

.player-row{
  display:flex;
  justify-content:space-between;
  padding:12px 14px;
  border-bottom:1px solid rgba(255,255,255,.05);
  cursor:pointer;
  transition:.2s;
}
.player-row:hover{
  background:rgba(59,130,246,.12);
}

/* SIDE PANEL */
.side-panel{
  position:fixed;
  right:-420px;
  top:0;
  width:400px;
  height:100%;
  background:#0f172a;
  border-left:1px solid var(--border);
  padding:25px;
  transition:.3s ease;
  z-index:1000;
}
.side-panel.active{
  right:0;
}
.panel-title{
  font-size:18px;
  font-weight:900;
  margin-bottom:20px;
}
.action-btn{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-weight:700;
}
.btn-kick{ background:rgba(245,158,11,.2); color:#f59e0b;}
.btn-ban{ background:rgba(239,68,68,.2); color:#ef4444;}
.btn-dm{ background:rgba(59,130,246,.2); color:#3b82f6;}
</style>
</head>

<body>

<div id="playerPanel" class="side-panel">
  <div class="panel-title" id="panelPlayerName">Player</div>
  <div id="panelInfo" style="margin-bottom:20px;color:var(--muted)"></div>

  <button class="action-btn btn-kick" onclick="kickSelected()">Kick</button>
  <button class="action-btn btn-ban" onclick="banSelected()">Ban</button>
  <button class="action-btn btn-dm" onclick="dmSelected()">Send DM</button>

  <button style="margin-top:20px" onclick="closePanel()">Close</button>
</div>

<div class="sidebar">
  <div class="logo">ðŸ‘» GhostGuard</div>
  <div class="nav-item active" onclick="showView('dashboard',this)">Dashboard</div>
  <div class="nav-item" onclick="showView('players',this)">Players</div>
  <div class="nav-item" onclick="showView('logs',this)">Server Logs</div>
</div>

<div class="content">

<div id="dashboardView">
  <div class="grid">
    <div class="card">
      <div class="card-title">License Info</div>
      <div>Key: <b id="license-key">-</b></div>
      <div>Status: <span id="license-status">-</span></div>
      <div>Expires: <span id="license-expire">-</span></div>
    </div>

    <div class="card">
      <div class="card-title">Server Status</div>
      <div>Status: <span id="server-status">Loading...</span></div>
      <div>Players: <b id="players-count">0</b></div>
      <div>Version: <b id="server-version">-</b></div>
      <div>Uptime: <b id="server-uptime">0s</b></div>
    </div>
  </div>
</div>

<div id="playersView" class="hidden">
  <div class="card">
    <div class="card-title">Online Players</div>
    <div id="players-list"></div>
  </div>
</div>

<div id="logsView" class="hidden">
  <div class="card">
    <div class="card-title">Live Server Logs</div>
    <div id="logs-box"></div>
  </div>
</div>

</div>

<script>
const API = "https://ghostgaurd-becakd.onrender.com";
const licenseKey = localStorage.getItem("gg_license_key");
let selectedPlayer = null;

/* VIEW SWITCH */
function showView(view, el){
  document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
  el.classList.add("active");

  document.getElementById("dashboardView").classList.add("hidden");
  document.getElementById("playersView").classList.add("hidden");
  document.getElementById("logsView").classList.add("hidden");

  document.getElementById(view+"View").classList.remove("hidden");
}

/* PLAYERS */
async function fetchPlayers(){
  const res = await fetch(API+"/api/server/players/"+licenseKey);
  const data = await res.json();
  const list = data.players || [];
  const container = document.getElementById("players-list");

  if(list.length === 0){
    container.innerHTML = "<div style='opacity:.6'>Inga spelare online</div>";
    return;
  }

  container.innerHTML = list.map(p=>`
    <div class="player-row" onclick="openPlayerPanel(${p.id},'${p.name}',${p.ping})">
      <div>
        <div style="font-weight:700">${p.name}</div>
        <div style="font-size:12px;opacity:.6">ID: ${p.id} â€¢ Ping: ${p.ping}</div>
      </div>
      <div>â†’</div>
    </div>
  `).join("");
}

function openPlayerPanel(id,name,ping){
  selectedPlayer=id;
  document.getElementById("panelPlayerName").innerText=name;
  document.getElementById("panelInfo").innerText=`ID: ${id} â€¢ Ping: ${ping}`;
  document.getElementById("playerPanel").classList.add("active");
}
function closePanel(){
  document.getElementById("playerPanel").classList.remove("active");
}

/* ACTIONS */
async function sendAction(type, payload){
  const token = localStorage.getItem("gg_token");
  const res = await fetch(API + "/api/dashboard/action", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ token, type, payload })
  });
  return res.json();
}

async function openKick(){
  const reason = prompt("Anledning fÃ¶r kick?");
  if(!reason) return;
  await sendAction("kick", { player: selectedPlayer, reason });
  closePanel();
}

async function openBan(){
  const reason = prompt("Anledning fÃ¶r ban?");
  if(!reason) return;
  const time = prompt("Tid (30m, 2h, 7d, P)?");
  if(!time) return;
  await sendAction("ban", { player: selectedPlayer, reason, duration: time });
  closePanel();
}

async function openDM(){
  const message = prompt("Skriv DM till spelaren:");
  if(!message) return;
  await sendAction("dm", { player: selectedPlayer, message });
  closePanel();
}


/* LICENSE */
async function fetchLicense(){
  const token = localStorage.getItem("gg_token");

  if(!token){
    document.getElementById("license-key").innerText = "Ingen session";
    return;
  }

  const res = await fetch(API+"/customer/dashboard",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({token})
  });

  const data = await res.json();

  if(!data.success){
    document.getElementById("license-key").innerText = "Session fel";
    return;
  }

  const lic = data.data;

  document.getElementById("license-key").innerText = lic.license_key;

  /* STATUS */
  const statusEl = document.getElementById("license-status");
  statusEl.innerText = lic.status;

  if(lic.status === "ACTIVE"){
    statusEl.className = "status-online";
  } else {
    statusEl.className = "status-offline";
  }

  /* EXPIRE */
  if(!lic.expires_at){
    document.getElementById("license-expire").innerText = "Lifetime";
  } else {
    document.getElementById("license-expire").innerText =
      formatExpire(lic.expires_at);
  }
}


  function formatExpire(dateStr){
  const expire = new Date(dateStr);
  const now = new Date();

  if(expire < now){
    return "Expired";
  }

  const diff = expire - now;

  const days = Math.floor(diff / (1000*60*60*24));
  const hours = Math.floor((diff / (1000*60*60)) % 24);
  const minutes = Math.floor((diff / (1000*60)) % 60);

  return expire.toLocaleString() + 
         `  (${days}d ${hours}h ${minutes}m kvar)`;
}


/* STATUS */
async function fetchServerStatus(){
  const res=await fetch(API+"/api/server/status/"+licenseKey);
  const data=await res.json();
  const online=data.online;
  const el=document.getElementById("server-status");
  el.innerText=online?"Online":"Offline";
  el.className=online?"status-online":"status-offline";

  document.getElementById("players-count").innerText=data.players||0;
  document.getElementById("server-version").innerText=data.version||"-";
  document.getElementById("server-uptime").innerText=formatUptime(data.uptime||0);
}
function formatUptime(s){
  const h=Math.floor(s/3600);
  const m=Math.floor((s%3600)/60);
  const sec=s%60;
  return `${h}h ${m}m ${sec}s`;
}

/* LOGS */
async function fetchLogs(){
  const res=await fetch(API+"/api/server/logs/"+licenseKey);
  const data=await res.json();
  const logs=data.data||[];
  document.getElementById("logs-box").innerHTML=
    logs.slice(0,50).map(l=>`
      <div style="padding:6px 0;border-bottom:1px solid rgba(255,255,255,.05)">
        <div style="font-size:12px;opacity:.6">${new Date(l.time).toLocaleTimeString()}</div>
        ${l.message}
      </div>
    `).join("");
}

/* AUTO */
setInterval(fetchPlayers,3000);
setInterval(fetchServerStatus,5000);
setInterval(fetchLogs,3000);

fetchPlayers();
fetchLicense();
fetchServerStatus();
fetchLogs();
</script>
</body>
</html>


