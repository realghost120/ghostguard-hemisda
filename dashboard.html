<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GhostGuard Panel</title>

<style>
:root{
  --bg:#060b18;
  --sidebar:#0c1426;
  --card:#111c33;
  --border:rgba(255,255,255,.08);
  --blue:#3b82f6;
  --green:#22c55e;
  --red:#ef4444;
  --yellow:#f59e0b;
  --text:#e6f0ff;
  --muted:rgba(230,240,255,.6);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Arial,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
}
.sidebar{
  width:230px;
  background:var(--sidebar);
  min-height:100vh;
  padding:20px 15px;
  border-right:1px solid var(--border);
}
.logo{font-weight:900;font-size:18px;margin-bottom:22px}
.nav-item{
  padding:12px;
  border-radius:10px;
  margin-bottom:8px;
  cursor:pointer;
  color:var(--muted);
}
.nav-item.active{
  background:rgba(59,130,246,.25);
  color:var(--text);
}
.content{flex:1;padding:26px}
.card{
  background:var(--card);
  padding:18px;
  border-radius:14px;
  border:1px solid var(--border);
  margin-bottom:18px;
}
.row{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
}
.status-online{color:var(--green);font-weight:900}
.status-offline{color:var(--red);font-weight:900}
.status-warn{color:var(--yellow);font-weight:900}
.hidden{display:none}
</style>
</head>

<body>

<div class="sidebar">
  <div class="logo">ðŸ‘» GhostGuard</div>
  <div class="nav-item active" onclick="showView('dashboard',this)">Dashboard</div>
  <div class="nav-item" onclick="showView('players',this)">Players</div>
  <div class="nav-item" onclick="showView('logs',this)">Server Logs</div>
</div>

<div class="content">

<div id="dashboardView">
  <div class="card">
    <h3>License</h3>
    <div class="row"><span>Status</span><span id="license-status">Loading...</span></div>
    <div class="row"><span>Expires</span><span id="license-expire">-</span></div>
    <div class="row"><span>Time Left</span><span id="license-left">-</span></div>
  </div>

  <div class="card">
    <h3>Server</h3>
    <div class="row"><span>Status</span><span id="server-status">Loading...</span></div>
    <div class="row"><span>Players</span><span id="players-count">0</span></div>
  </div>
</div>

<div id="playersView" class="hidden">
  <div class="card">
    <h3>Online Players</h3>
    <div id="players-list"></div>
  </div>
</div>

<div id="logsView" class="hidden">
  <div class="card">
    <h3>Server Logs</h3>
    <div id="logs-box"></div>
  </div>
</div>

</div>

<script>
const API = "https://ghostgaurd-becakd.onrender.com";
const licenseKey = localStorage.getItem("gg_license_key") || "";

function showView(view, el){
  document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
  el.classList.add("active");
  ["dashboard","players","logs"].forEach(v=>{
    document.getElementById(v+"View").classList.add("hidden");
  });
  document.getElementById(view+"View").classList.remove("hidden");
}

function calcTimeLeft(expiresAt){
  if(!expiresAt) return "Lifetime";
  const exp = new Date(expiresAt);
  const now = new Date();
  if(exp <= now) return "Expired";
  const diff = exp - now;
  const days = Math.floor(diff / (1000*60*60*24));
  const hours = Math.floor((diff / (1000*60*60)) % 24);
  const minutes = Math.floor((diff / (1000*60)) % 60);
  return `${days}d ${hours}h ${minutes}m`;
}

async function fetchLicense(){
  const token = localStorage.getItem("gg_token") || "";
  const statusEl = document.getElementById("license-status");
  const expireEl = document.getElementById("license-expire");
  const leftEl = document.getElementById("license-left");

  if(!token){
    statusEl.innerText = "NO SESSION";
    statusEl.className = "status-warn";
    return;
  }

  try{
    const res = await fetch(API + "/customer/dashboard", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ token })
    });

    if(!res.ok) throw new Error("HTTP "+res.status);

    const data = await res.json();
    if(!data.success) throw new Error("Invalid response");

    const lic = data.data;

    statusEl.innerText = lic.status;
    statusEl.className =
      lic.status === "ACTIVE" ? "status-online" :
      lic.status === "EXPIRED" ? "status-offline" :
      "status-warn";

    expireEl.innerText =
      lic.expires_at
        ? new Date(lic.expires_at).toLocaleString()
        : "Lifetime";

    leftEl.innerText = calcTimeLeft(lic.expires_at);

  }catch(err){
    console.error(err);
    statusEl.innerText = "OFFLINE";
    statusEl.className = "status-offline";
  }
}

async function fetchServerStatus(){
  if(!licenseKey) return;

  try{
    const res = await fetch(API + "/api/server/status/" + encodeURIComponent(licenseKey));
    const data = await res.json();

    const el = document.getElementById("server-status");
    el.innerText = data.online ? "Online" : "Offline";
    el.className = data.online ? "status-online" : "status-offline";
    document.getElementById("players-count").innerText = data.players || 0;
  }catch(e){
    console.error(e);
  }
}

setInterval(fetchLicense, 10000);
setInterval(fetchServerStatus, 5000);

fetchLicense();
fetchServerStatus();
</script>

</body>
</html>
