<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GhostGuard Panel</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0b1220;
  color:white;
  display:flex;
}

.sidebar{
  width:220px;
  background:#111827;
  padding:20px;
}

.sidebar h2{
  margin-top:0;
}

.sidebar div{
  margin:12px 0;
  cursor:pointer;
}

.content{
  flex:1;
  padding:30px;
}

.card{
  background:#1f2937;
  padding:20px;
  border-radius:10px;
  margin-bottom:20px;
}

.player{
  padding:10px;
  background:#1f2937;
  margin-bottom:8px;
  cursor:pointer;
  border-radius:6px;
}

.player:hover{
  background:#374151;
}

#panel{
  position:fixed;
  right:-350px;
  top:0;
  width:300px;
  height:100%;
  background:#111827;
  padding:20px;
  transition:0.3s;
}

#panel.active{
  right:0;
}

button{
  width:100%;
  margin-top:10px;
  padding:10px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="sidebar">
  <h2>GhostGuard</h2>
  <div onclick="show('dashboard')">Dashboard</div>
  <div onclick="show('players')">Players</div>
</div>

<div class="content">

  <div id="dashboard">
    <div class="card">
      <h3>License</h3>
      <div>Status: <span id="licenseStatus">Loading...</span></div>
      <div>Expires: <span id="licenseExpire">-</span></div>
    </div>

    <div class="card">
      <h3>Server</h3>
      <div>Status: <span id="serverStatus">Loading...</span></div>
      <div>Players: <span id="playerCount">0</span></div>
    </div>
  </div>

  <div id="players" style="display:none;">
    <h3>Online Players</h3>
    <div id="playerList"></div>
  </div>

</div>

<div id="panel">
  <h3 id="panelName">Player</h3>
  <div id="panelId"></div>

  <button onclick="kick()">Kick</button>
  <button onclick="ban()">Ban</button>
  <button onclick="dm()">DM</button>
  <button onclick="closePanel()">Close</button>
</div>

<script>
const API = "https://ghostgaurd-becakd.onrender.com";
const licenseKey = localStorage.getItem("gg_license_key") || "";
const token = localStorage.getItem("gg_token") || "";

let selectedPlayer = null;

/* VIEW */
function show(view){
  document.getElementById("dashboard").style.display="none";
  document.getElementById("players").style.display="none";
  document.getElementById(view).style.display="block";
}

/* LICENSE */
async function fetchLicense(){
  if(!token) return;

  const res = await fetch(API + "/customer/dashboard",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({token})
  });

  const data = await res.json();
  if(!data.success) return;

  document.getElementById("licenseStatus").innerText = data.data.status;
  document.getElementById("licenseExpire").innerText =
    data.data.expires_at ? new Date(data.data.expires_at).toLocaleString() : "Lifetime";
}

/* SERVER STATUS */
async function fetchServer(){
  const res = await fetch(API + "/api/server/status/" + encodeURIComponent(licenseKey));
  const data = await res.json();

  document.getElementById("serverStatus").innerText = data.online ? "Online" : "Offline";
  document.getElementById("playerCount").innerText = data.players || 0;
}

/* PLAYERS */
async function fetchPlayers(){
  const res = await fetch(API + "/api/server/players/" + encodeURIComponent(licenseKey));
  const data = await res.json();

  const list = data.players || [];
  const container = document.getElementById("playerList");

  container.innerHTML = list.map(p => `
    <div class="player" onclick="openPanel(${p.id}, '${p.name}')">
      ${p.name} (ID: ${p.id})
    </div>
  `).join("");
}

function openPanel(id,name){
  selectedPlayer = id;
  document.getElementById("panelName").innerText = name;
  document.getElementById("panelId").innerText = "Server ID: " + id;
  document.getElementById("panel").classList.add("active");
}

function closePanel(){
  document.getElementById("panel").classList.remove("active");
}

/* ACTIONS */
async function send(type,payload){
  await fetch(API + "/api/dashboard/action",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      token,
      license_key: licenseKey,
      type,
      payload
    })
  });
}

async function kick(){
  const reason = prompt("Reason:");
  if(!reason) return;
  await send("kick",{player:selectedPlayer,reason});
  alert("Kick sent");
}

async function ban(){
  const reason = prompt("Reason:");
  if(!reason) return;
  const duration = prompt("Duration (30m, 2h, 7d, P):");
  if(!duration) return;
  await send("ban",{player:selectedPlayer,reason,duration});
  alert("Ban sent");
}

async function dm(){
  const message = prompt("Message:");
  if(!message) return;
  await send("dm",{player:selectedPlayer,message});
  alert("DM sent");
}

/* AUTO */
setInterval(fetchServer,5000);
setInterval(fetchPlayers,3000);

fetchLicense();
fetchServer();
fetchPlayers();
</script>

</body>
</html>
